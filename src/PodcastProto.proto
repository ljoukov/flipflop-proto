syntax = "proto3";

import "google/protobuf/duration.proto";
import "google/protobuf/timestamp.proto";

message PodcastStreamApiRequestProto {
  string encoded_user_auth = 1;
  oneof request {
    CreatePodcastRequestProto create = 2;
    GeneratePodcastRequestProto generate = 3;
    ListPodcastsRequestProto list = 4;
  }
}

message PodcastStreamApiResponseHeaderProto {
  // If present the token was refreshed and the client should use this new one
  // from now onwards.
  string refreshed_encoded_user_auth = 1;
  oneof header {
    CreatePodcastResponseHeaderProto create_header = 2;
    GeneratePodcastResponseHeaderProto generate = 3;
    ListPodcastsResponseHeaderProto list = 4;
  }
  map<string, google.protobuf.Duration> latencies = 100;
}

message PodcastStreamApiResponseDeltaProto {
  oneof response_delta {
    CreatePodcastResponseDeltaProto create_delta = 1;
    GeneratePodcastResponseDeltaProto generate_delta = 2;
    ListPodcastsResponseDeltaProto list_delta = 3;
  }
}

message CreatePodcastRequestProto {
  string prompt = 1;
}

message CreatePodcastResponseHeaderProto {}

message CreatePodcastResponseDeltaProto {
  oneof type {
    bool separator = 1;

    // This is the last delta message
    bool error_no_topic = 2;

    // IDs start at 10
    PodcastProto podcast = 10;
  }
}

message GeneratePodcastRequestProto {
  string podcast_id = 1;
}

message GeneratePodcastResponseHeaderProto {}

message GeneratePodcastResponseDeltaProto {
  oneof type {
    PodcastStateProto state_update = 1;
    string audio_path = 2;
  }
}

message ListPodcastsRequestProto {}

message ListPodcastsResponseHeaderProto {
  repeated PodcastProto podcasts = 1;
}

message ListPodcastsResponseDeltaProto {
  oneof type {
    bool ping = 1;
    PodcastProto updated_podcast = 2;
    string deleted_podcast_id = 3;
  }
}

message PodcastProto {
  string podcast_id = 1;

  string created_by = 2;
  google.protobuf.Timestamp created_at = 3;
  google.protobuf.Timestamp updated_at = 4;

  PodcastStateProto state = 5;

  string title = 6;
  string title_emoji = 7;
  string synopsis = 8;
  string short_synopsis = 9;

  string audio_path = 10;
  google.protobuf.Duration audio_duration = 11;

  PodcastVisualsProto visuals = 12;
}

message StoredPodcastProto {
  string podcast_id = 1;

  string created_by = 2;
  google.protobuf.Timestamp created_at = 3;
  google.protobuf.Timestamp updated_at = 4;

  string user_prompt = 5;

  PodcastStateProto state = 6;

  string reasoning = 7;
  string title = 8;
  string title_emoji = 9;
  string hook = 10;
  string short_hook = 11;

  string plan = 12;
  PodcastTranscriptProto transcript = 13;

  string audio_key = 14;
  google.protobuf.Duration audio_duration = 15;

  PodcastVisualsProto visuals = 16;
}

enum PodcastStateProto {
  PODCAST_STATE_PROTO_UNKNOWN = 0;
  PODCAST_STATE_PROTO_READY = 1;

  PODCAST_STATE_PROTO_GENERATING_SYNOPSYS = 2;
  PODCAST_STATE_PROTO_SYNOPSYS_READY = 3;

  PODCAST_STATE_PROTO_GENERATING_PLAN = 4;
  PODCAST_STATE_PROTO_PLAN_READY = 5;

  PODCAST_STATE_PROTO_GENERATING_TRANSCRIPT = 6;
  PODCAST_STATE_PROTO_TRANSCRIPT_READY = 7;

  PODCAST_STATE_PROTO_GENERATING_AUDIO = 8;
  PODCAST_STATE_PROTO_AUDIO_READY = 9;

  PODCAST_STATE_PROTO_GENERATING_VISUALS = 10;
  PODCAST_STATE_PROTO_VISUALS_READY = 11;
}

message PodcastTranscriptProto {
  string images_style = 1;
  string thumbnail_prompt = 2;
  repeated PodcastSectionTranscriptProto sections = 3;
}

message PodcastSectionTranscriptProto {
  PodcastSectionTypeProto section_type = 1;
  repeated PodcastTranscriptEntryProto entries = 2;
}

enum PodcastSectionTypeProto {
  PODCAST_SECTION_TYPE_PROTO_UNKNOWN = 0;
  PODCAST_SECTION_TYPE_PROTO_INTRODUCTION = 1;
  PODCAST_SECTION_TYPE_PROTO_SECTION = 2;
  PODCAST_SECTION_TYPE_PROTO_CONCLUSION = 3;
}

message PodcastTranscriptEntryProto {
  oneof type {
    PodcastHostSpeechProto host = 1;
    string image_prompt = 2;
  }
}

message PodcastHostSpeechProto {
  PodcastHostProto host = 1;
  string text = 2;
  int32 start_millis = 3;
}

enum PodcastHostProto {
  PODCAST_HOST_PROTO_UNKNOWN = 0;
  PODCAST_HOST_PROTO_MALE = 1;
  PODCAST_HOST_PROTO_FEMALE = 2;
}

message PodcastVisualsProto {
  string thumbnail_key = 1;
  repeated PodcastVisualProto visuals = 2;
}

message PodcastVisualProto {
  int32 timestamp_millis = 1;
  string image_key = 2;
}
