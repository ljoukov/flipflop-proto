syntax = "proto3";

import "google/protobuf/duration.proto";
import "google/protobuf/timestamp.proto";

message ChatApiRequestProto {
  oneof request {
    GetChatActivitiesRequestProto get_chat_activities = 1;
    GetChatSessionRequestProto get_chat_session = 2;
    UpdateChatSessionRequestProto update_chat_session = 3;
    DeleteChatSessionRequestProto delete_chat_session = 4;
  }
}

message ChatApiResponseProto {
  oneof response {
    GetChatActivitiesResponseProto get_chat_activities = 1;
    GetChatSessionResponseProto get_chat_session = 2;
    UpdateChatSessionResponseProto update_chat_session = 3;
    DeleteChatSessionResponseProto delete_chat_session = 4;
  }
  map<string, google.protobuf.Duration> latencies = 100;
}

message GetChatActivitiesRequestProto {
}

message GetChatActivitiesResponseProto {
  repeated ChatActivityProto activities = 1;
}

message GetChatSessionRequestProto {
  string story_id = 1;
}

message GetChatSessionResponseProto {
  ChatSessionProto chat_session = 1;
}

message UpdateChatSessionRequestProto {
  ChatSessionProto chat_session = 1;
}

message UpdateChatSessionResponseProto {
}

message DeleteChatSessionRequestProto {
  string chat_session_id = 1;
}

message DeleteChatSessionResponseProto {
}

message ChatActivityProto {
  // Machine identifier, LLM-readable, e.g. "compare-and-contrast", "writing-challenge"
  string activity_id =  1;
  // How it should be diplayed to the user
  string display_name = 2;
  string description_prompt = 3;
  string action_prompt = 4;
}

message ChatSystemMessageProto {
  string text = 1;
}

message ChatAssistantMessageProto {
  enum Status {
    STATUS_UNDEFINED = 0;
    STATUS_COMPLETE = 1;
    STATUS_STREAMED = 2;
    STATUS_INTERRUPTED = 3;
    STATUS_FAILED = 4;
  }
  Status status = 1;  
  string text = 2;
  repeated string activity_ids = 3;
}

message ChatUserMessageProto {
  // Explicitly entered by the user
  string text = 1;

  // User selected one of the activities
  string activity_id = 2;
}

message ChatMessageProto {
  string message_id = 1;
  google.protobuf.Timestamp created_at = 2;
  oneof type {
    ChatSystemMessageProto system = 3;
    ChatAssistantMessageProto assistant = 4;
    ChatUserMessageProto user = 5;
  }
}

message ChatContextProto {
  string story_id = 1;
}

message ChatSessionProto {
  string chat_session_id = 1;
  google.protobuf.Timestamp created_at = 2;
  google.protobuf.Timestamp last_modified_at = 3;
  ChatContextProto context = 4;
  repeated ChatMessageProto messages = 5;
}